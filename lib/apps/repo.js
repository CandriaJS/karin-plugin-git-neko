import {e,c}from'../chunk-UBICTORI.js';import {d,b}from'../chunk-SWUTSNE3.js';import m,{logger}from'node-karin';var h=m.command(/^#?(?:(?:清语)?Git插件|git-plugin)?(?:GitHub)(?:仓库|repo)(?:信息|info)\s*([\w-]+)[\/\s]+([\w-]+)/i,async r=>{try{let e$1=r.msg.match(h.reg);if(!e$1)throw new Error("\u55B5\u545C~ \u8BF7\u8F93\u5165\u8981\u67E5\u8BE2\u7684\u4ED3\u5E93\u540D");let[,o,s]=e$1,l=await e.get_user_token(r.userId),t=await(await c.get_github(l??void 0).get_repo()).get_repo_info({owner:o,repo:s}),n=await d.render("repo/get_repo_info",{type:"github",owner:t.data.owner?.login??"\u672A\u77E5",repo:t.data.name??"\u672A\u77E5",visibility:t.data.private,language:t.data.language??"\u672A\u77E5",description:t.data.description??"\u65E0\u63CF\u8FF0",url:t.data.html_url??"\u672A\u77E5",created_at:t.data.created_at??"\u672A\u77E5",updated_at:t.data.updated_at??"\u672A\u77E5",pushed_at:t.data.pushed_at??"\u672A\u77E5",star_count:t.data.stargazers_count??"\u672A\u77E5",fork_count:t.data.forks_count??"\u672A\u77E5",issue_count:t.data.open_issues_count??"\u672A\u77E5"});return await r.reply(n),!0}catch(e){return logger.error(e),await r.reply(`[${b.Plugin_AliasName}]: ${e.message}`),true}}),w=m.command(/^#?(?:(?:清语)?Git插件|git-plugin)?GitHub(?:组织|org)(?:仓库|repo)(?:列表|list)\s*(.+)?/i,async r=>{try{let e$1=r.msg.match(w.reg);if(!e$1)throw new Error("\u55B5\u545C~ \u8BF7\u8F93\u5165\u8981\u67E5\u8BE2\u7684\u7EC4\u7EC7\u540D");let[,o]=e$1,s=await e.get_user_token(r.userId),t=(await(await c.get_github(s??void 0).get_repo()).get_org_repos_list({org:o})).data.map(a=>({name:a.name,visibility:a.private,language:a.language??"\u672A\u77E5",star_count:a.stargazers_count??0,pushed_at:a.pushed_at??"\u672A\u77E5"})),n=await d.render("repo/get_org_repos_list",{type:"github",repo_list:t});return await r.reply(n),!0}catch(e){logger.error(e),await r.reply(`[${b.Plugin_AliasName}]: ${e.message}`);}},{name:"\u6E05\u8BEDGit\u63D2\u4EF6:\u7EC4\u7EC7\u4ED3\u5E93\u5217\u8868",priority:-1/0,event:"message",permission:"all"}),y=m.command(/^#?(?:(?:清语)?Git插件|git-plugin)?GitHub(?:用户|org)(?:仓库|repo)(?:列表|list)\s*(.*)/i,async r=>{try{let o=r.msg.match(y.reg)?.[1];console.log(o);let s=await e.get_user_token(r.userId),g=await c.get_github(s??void 0).get_repo(),i;if(o)i=await g.get_user_repos_list({username:o,type:"owner"});else {if(!s)throw new Error("\u55B5\u545C~ \u8BF7\u5148\u8FDB\u884C\u5E94\u7528\u5B89\u88C5\u7136\u540E\u8FDB\u884C\u6388\u6743\u5B89\u88C5");i=await g.get_user_repos_list_by_token({type:"owner"});}let t=i.data.map(a=>({name:a.name,visibility:a.private,language:a.language??"\u672A\u77E5",star_count:a.stargazers_count??"\u672A\u77E5",pushed_at:a.pushed_at??"\u672A\u77E5"})),n=await d.render("repo/get_user_repos_list",{type:"github",repo_list:t});return await r.reply(n),!0}catch(e){logger.error(e),await r.reply(`[${b.Plugin_AliasName}]: ${e.message}`);}});export{w as get_org_repos_list,h as get_repo_info,y as get_user_repos_list};