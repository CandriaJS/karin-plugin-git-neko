import {c,a,e}from'../chunk-UBICTORI.js';import {b as b$1}from'../chunk-SWUTSNE3.js';import u,{logger}from'node-karin';var g=c.get_github(),$=u.command(/^#?((清语)?Git插件|karin-plugin-git-neko)?(GitHub)(Auth|授权)(安装|install)$/i,async t=>{try{if(t.isGroup)return await t.reply("\u55B5\u545C~ \u8BF7\u79C1\u804A\u6211\u8FDB\u884C\u6388\u6743\u5B89\u88C5",{at:!0});let e=await a.get_state_id(t),r=new URL(`${(await a.get_base_url()).local_url}/github/auth/install`);return r.searchParams.set("state",e),await t.reply(`\u8BF7\u524D\u5F80\u4EE5\u4E0B\u94FE\u63A5\u8FDB\u884C\u5B89\u88C5:
`+r.toString(),{at:!0}),!0}catch(e){return logger.error(e),await t.reply(`[${b$1.Plugin_AliasName}]: ${e.message}`),true}},{name:"\u6E05\u8BEDGit\u63D2\u4EF6:\u6388\u6743\u5B89\u88C5",priority:-1/0,event:"message",permission:"all"}),b=u.command(/^#?((清语)?Git插件|karin-plugin-git-neko)?(GitHub)(Auth|授权)(检查|check)$/i,async t=>{try{let e$1=await e.get_user_token(t.userId);if(!e$1)throw new Error("\u55B5\u545C~ \u8BF7\u5148\u8FDB\u884C\u5E94\u7528\u5B89\u88C5\u7136\u540E\u8FDB\u884C\u6388\u6743\u5B89\u88C5");let _=(await(await g.get_auth()).check_token_status({access_token:e$1})).data.info;return await t.reply(_,{at:!0}),!0}catch(e){return logger.error(e),await t.reply(`[${b$1.Plugin_AliasName}]: ${e.message}`),true}},{name:"\u6E05\u8BEDGit\u63D2\u4EF6:\u6388\u6743\u68C0\u67E5",priority:-1/0,event:"message",permission:"all"}),x=u.command(/^#?((清语)?Git插件|karin-plugin-git-neko)?(GitHub)(Auth|授权)(刷新|refresh)$/i,async t=>{try{if(!await e.get_user_token(t.userId))throw new Error("\u55B5\u545C~ \u8BF7\u5148\u8FDB\u884C\u5E94\u7528\u5B89\u88C5\u7136\u540E\u8FDB\u884C\u6388\u6743\u5B89\u88C5");let r=await e.get_user_refresh_token(t.userId),i;if(r){let a=await(await g.get_auth()).refresh_token({refresh_token:r}),h=a.data.access_token,m=a.data.expires_in;r=a.data.refresh_token;let k=a.data.refresh_token_expires_in;await e.update_user_token(t.userId,h,m,String(r),Number(k)),i=a.data.info;}else i="\u55B5\u545C, \u65E0\u8FC7\u671F\u65F6\u95F4token, \u65E0\u9700\u5237\u65B0";return await t.reply(i,{at:!0}),!0}catch(e){return logger.error(e),await t.reply(`[${b$1.Plugin_AliasName}]: ${e.message}`),true}},{name:"\u6E05\u8BEDGit\u63D2\u4EF6:\u6388\u6743\u5237\u65B0",priority:-1/0,event:"message",permission:"all"});export{b as auth_check,$ as auth_install,x as auth_refresh};